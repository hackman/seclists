<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Security News</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #2c193f; /* Dark purple background */
      color: #fff; /* Light text */
    }
    .article-list {
      list-style-type: none;
	  padding-left: 30px;
    }
    .article-item {
      margin-bottom: 5px; /* Reduced margin */
      padding: 5px;
      border-radius: 3px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s ease;
      background-color: #443266; /* Darker purple background */
      position: relative; /* Position relative for popup */
	  width: 70%;
    }
    .article-item:hover {
      background-color: #553f7b; /* Darker background on hover */
    }
    .group-icon {
      width: 20px;
      height: 20px;
      margin-right: 8px;
    }
    .article-link {
      color: #77cc08; /* Blue color */
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .article-link:hover {
      color: #00aaff; /* Lighter blue on hover */
      text-decoration: underline;
    }
    /* Popup styles */
    .popup {
      display: none;
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: #fff;
	  top: 10px;
	  right: 20px;
      border-radius: 5px;
      padding: 20px;
	  width: 500px;
	  min-height: 550px;
      max-width: 70%;
      max-height: 70vh;
      overflow-y: auto;
      z-index: 999; /* Ensure popup is on top */
    }
    .popup-close {
      position: absolute;
      top: 5px;
      left: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <ul id="articleList" class="article-list"></ul>

  <!-- Popup HTML -->
  <div class="popup" id="popup">
    <span class="popup-close" id="popupClose">&times;</span>
    <div id="popupContent"></div>
  </div>

  <script>
// Function to convert Unix timestamp to human-readable format
function unixTimestampToReadable(timestamp) {
    // Create a new Date object with the Unix timestamp multiplied by 1000 to convert to milliseconds
    const date = new Date(timestamp * 1000);

    // Get individual date and time components
    const year = date.getFullYear();
    const month = ('0' + (date.getMonth() + 1)).slice(-2); // Months are zero-based
    const day = ('0' + date.getDate()).slice(-2);
    const hours = ('0' + date.getHours()).slice(-2);
    const minutes = ('0' + date.getMinutes()).slice(-2);
    const seconds = ('0' + date.getSeconds()).slice(-2);

    // Construct the human-readable date and time format
    const formattedDateTime = day + '-' + month + '-' + year + ' ' + hours + ':' + minutes + ':' + seconds;

    return formattedDateTime;
}
    document.addEventListener("DOMContentLoaded", function() {
      const popup = document.getElementById('popup');

      // Function to fetch data via AJAX
      function fetchData() {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
              const jsonData = JSON.parse(xhr.responseText);
              displayData(jsonData);
            } else {
              console.error('Failed to fetch data');
            }
          }
        };
        xhr.open('GET', '/data.json'); // Changed URL here
        xhr.send();
      }

      // Function to display data
      function displayData(data) {
        const list = document.getElementById('articleList');

		for (var i = 0; i < data.length; i++) {
			article = data[i];
			const listItem = document.createElement('li');
			listItem.classList.add('article-item');
			// Group icon based on group
			groupIcon = document.createElement('img');
			groupIcon.classList.add('group-icon');
			groupIcon.src = "/logos/" + article.group + ".png";
			listItem.appendChild(groupIcon);

			// Article title and link
			const titleLink = document.createElement('a');
			titleLink.href = article.link;
			titleLink.textContent = unixTimestampToReadable(article.date) + " " + article.title;
			titleLink.classList.add('article-link'); // Add class for styling
			listItem.appendChild(titleLink);


			const description = article.description;
			// Add event listener for popup
			listItem.addEventListener('click', function(event) {
				event.stopPropagation(); // Prevent event from bubbling up
				showPopup(description);
			});

			// Append to list
			list.appendChild(listItem);
		}
	}
      // Show popup function
      function showPopup(description, clientX, clientY) {
        const popupContent = document.getElementById('popupContent');
        const popupClose = document.getElementById('popupClose');

        // Calculate popup position and size
        const popupWidth = Math.min(window.innerWidth * 0.7, popup.offsetWidth); // 70% of window width or actual width if smaller
        const popupHeight = Math.min(window.innerHeight * 0.7, popup.offsetHeight); // 70% of window height or actual height if smaller
        const popupLeft = Math.max(0, Math.min(clientX - popupWidth / 2, window.innerWidth - popupWidth)); // Center horizontally
        const popupTop = Math.max(0, Math.min(clientY - popupHeight, window.innerHeight - popupHeight)); // Position above cursor

        // Set popup position and size
//        popup.style.width = popupWidth + 'px';
        popup.style.height = popupHeight + 'px';
//        popup.style.left = popupLeft + 'px';
//        popup.style.top = popupTop + 'px';

        popupContent.innerHTML= description;
        popup.style.display = 'block';
//        popup.style.left = clientX + 'px';
//        popup.style.top = (clientY - popup.offsetHeight) + 'px';

        // Close popup on click outside or on close button
        window.addEventListener('click', function(event) {
          if (event.target == popup || event.target == popupClose) {
            popup.style.display = 'none';
          }
        });
      }

      // Fetch data on page load
      fetchData();
    });
  </script>
</body>
</html>

